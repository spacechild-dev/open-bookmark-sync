<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Bookmark Sync - Settings</title>
    <style>
        :root {
            --control-h: 35px;
            --space-1: 8px;
            --space-2: 13px; /* ~8 * 1.618 */
            --space-3: 21px; /* ~13 * 1.618 */
            --space-4: 34px; /* ~21 * 1.618 */
            --border-soft: #edf0f5;
            --text: #2f3137;
            --text-muted: #666;
            --panel-bg: #ffffff;
            --header-h: 72px;
            --sidebar-w: 240px;
            --notification-h: 0px; /* dynamic notification bar height */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 16px;
            background-color: #f5f5f5;
            font-size: 13px;
            line-height: 1.55;
            color: var(--text);
        }

        /* Welcome Modal Styles */
        .welcome-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        .welcome-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .welcome-modal {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .welcome-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 32px;
            text-align: center;
            border-radius: 16px 16px 0 0;
        }
        .welcome-header h1 {
            margin: 0 0 12px 0;
            font-size: 28px;
            color: white;
        }
        .welcome-header p {
            margin: 0;
            opacity: 0.95;
            font-size: 14px;
        }
        .welcome-content {
            padding: 32px;
        }
        .welcome-step {
            display: flex;
            gap: 20px;
            margin-bottom: 28px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.2s;
        }
        .welcome-step:hover {
            background: #e9ecef;
            transform: translateX(4px);
        }
        .step-number {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
        }
        .step-content h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #2c3e50;
        }
        .step-content p {
            margin: 0;
            font-size: 13px;
            color: #6c757d;
            line-height: 1.6;
        }
        .welcome-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 0 32px 32px 32px;
        }
        .welcome-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .welcome-btn.primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        .welcome-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
        }
        .welcome-btn.secondary {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        .welcome-btn.secondary:hover {
            background: #e9ecef;
        }

        /* Button Size Hierarchy */
        .button, button {
            height: var(--btn-height-md, 40px);
            padding: 0 20px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        /* Primary (Large) - 48px - Most important actions */
        .button.btn-lg, .button-large {
            height: 48px;
            padding: 0 32px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
        }

        /* Medium (Default) - 40px - Standard actions */
        .button.btn-md, .button-medium {
            height: 40px;
            padding: 0 20px;
            font-size: 14px;
        }

        /* Small - 32px - Secondary actions */
        .button.btn-sm, .button-small, .button.small {
            height: 32px;
            padding: 0 16px;
            font-size: 13px;
        }

        /* Tiny - 28px - Tertiary/inline actions */
        .button.btn-xs, .button-tiny {
            height: 28px;
            padding: 0 12px;
            font-size: 12px;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 6px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .button.loading {
            opacity: 0.7;
            pointer-events: none;
            cursor: not-allowed;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            height: 24px;
            margin: 12px 0;
            display: none;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-hover));
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 600;
        }
        .progress-container.visible {
            display: block;
        }

        /* Floating Action Buttons */
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        .fab:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        .fab-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
        }
        .fab-secondary {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        /* Semantic Color System */
        /* Safe Actions - Green */
        .button.safe, .button.success {
            background: #10b981;
            color: #ffffff;
            border-color: #059669;
        }
        .button.safe:hover, .button.success:hover {
            background: #059669;
            border-color: #047857;
        }

        /* Neutral Actions - Blue (Default) */
        .button.neutral, .button.info {
            background: var(--accent, #2563eb);
            color: #ffffff;
            border-color: var(--accent-hover, #1d4ed8);
        }
        .button.neutral:hover, .button.info:hover {
            background: var(--accent-hover, #1d4ed8);
        }

        /* Warning Actions - Orange/Yellow */
        .button.warning, .button.caution {
            background: #f59e0b;
            color: #ffffff;
            border-color: #d97706;
        }
        .button.warning:hover, .button.caution:hover {
            background: #d97706;
            border-color: #b45309;
        }

        /* Danger Actions - Red */
        .button.danger, .button.critical, .button.destructive {
            background: #ef4444;
            color: #ffffff;
            border-color: #dc2626;
        }
        .button.danger:hover, .button.critical:hover, .button.destructive:hover {
            background: #dc2626;
            border-color: #b91c1c;
        }

        /* Typography Scale */
        :root {
            /* Font Sizes */
            --font-xs: 11px;
            --font-sm: 12px;
            --font-base: 13px;
            --font-md: 14px;
            --font-lg: 16px;
            --font-xl: 18px;
            --font-2xl: 22px;
            --font-3xl: 28px;

            /* Line Heights */
            --leading-tight: 1.25;
            --leading-normal: 1.5;
            --leading-relaxed: 1.75;

            /* Font Weights */
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;

            /* Button Heights */
            --btn-height-xs: 28px;
            --btn-height-sm: 32px;
            --btn-height-md: 40px;
            --btn-height-lg: 48px;

            /* Spacing Scale (4px base) */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;
        }

        /* Typography Classes */
        h1, .text-3xl {
            font-size: var(--font-3xl);
            font-weight: var(--font-bold);
            line-height: var(--leading-tight);
        }

        h2, .text-2xl {
            font-size: var(--font-2xl);
            font-weight: var(--font-semibold);
            line-height: var(--leading-tight);
        }

        h3, .text-xl {
            font-size: var(--font-xl);
            font-weight: var(--font-semibold);
            line-height: var(--leading-normal);
        }

        h4, .text-lg {
            font-size: var(--font-lg);
            font-weight: var(--font-medium);
            line-height: var(--leading-normal);
        }

        p, .text-base {
            font-size: var(--font-base);
            line-height: var(--leading-relaxed);
        }

        .text-sm {
            font-size: var(--font-sm);
            line-height: var(--leading-normal);
        }

        .text-xs {
            font-size: var(--font-xs);
            line-height: var(--leading-normal);
        }

        .help-text, .text-muted {
            font-size: var(--font-sm);
            color: var(--text-muted, #6c757d);
            line-height: var(--leading-normal);
        }

        /* Notification Bar Styles - Theme Aware */
        .notification-bar {
            padding: 8px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        /* Modern notification bar - uses theme colors */
        .notification-bar-modern {
            background: var(--accent, #4f46e5);
            color: #ffffff;
        }

        .notification-bar-modern .notification-icon-box {
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notification-bar-modern .notification-icon-box .icon {
            width: 16px;
            height: 16px;
            opacity: 0.95;
        }

        .notification-bar-modern .notification-title {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 1px;
        }

        .notification-bar-modern .notification-subtitle {
            font-size: 11px;
            opacity: 0.9;
        }

        .notification-bar-modern .notification-btn {
            background: rgba(255,255,255,0.15);
            color: #ffffff;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .notification-bar-modern .notification-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        .notification-bar-modern .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-bar-modern .notification-close:hover {
            background: rgba(255,255,255,0.1);
            color: #ffffff;
        }

        /* Minimal notification bar - theme aware */
        .notification-bar-minimal {
            background: var(--accent-light, #fef3c7);
            color: var(--accent-dark-text, #92400e);
            padding: 8px 20px;
            font-size: 13px;
            border-bottom: 1px solid var(--accent, #fbbf24);
        }

        .notification-bar-minimal .notification-btn {
            background: var(--accent, #f59e0b);
            color: #ffffff;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .notification-bar-minimal .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            color: var(--accent-dark-text, #92400e);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 2px;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
        }

        h1 {
            color: var(--text);
            margin: 0 0 var(--space-2) 0;
            font-size: 22px;
            font-weight: 600;
        }

        h2 {
            color: var(--text);
            font-size: 16px;
            margin: var(--space-3) 0 var(--space-2) 0;
            font-weight: 600;
        }

        h3 {
            color: var(--text);
            font-size: 13px;
            margin: var(--space-2) 0 var(--space-1) 0;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text);
        }

        input[type="text"],
        input[type="url"],
        input[type="password"],
        select {
            width: 100%;
            height: var(--control-h);
            padding: 0 10px;
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
        }

        /* Visually downgrade disabled controls */
        input:disabled,
        select:disabled,
        .toggle-eye:disabled {
            background-color: #f1f3f6 !important;
            color: #8a8f98 !important;
            border-color: #e6e9ef !important;
            opacity: 0.55;
            cursor: not-allowed;
        }

        /* Unify number inputs look */
        input[type="number"] {
            width: 100%;
            height: var(--control-h);
            padding: 0 10px;
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="text"]:focus,
        input[type="url"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #5F7FFF;
            box-shadow: none;
        }
        /* Keep select focus neutral (no bright accent) */
        select:focus { outline: none; border-color: #d7dbe2; box-shadow: none; }

        .button {
            background-color: #007cba;
            color: white;
            border: none;
            height: var(--control-h);
            padding: 0 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex; align-items: center; justify-content: center;
        }

        .button:hover {
            background-color: #005a87;
        }

        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .button.secondary {
            background-color: #6c757d;
        }

        .button.secondary:hover {
            background-color: #545b62;
        }

        .button.danger {
            background-color: #dc3545;
        }

        .button.danger:hover {
            background-color: #c82333;
        }

        .status {
            padding: 12px;
            border-radius: 4px;
            margin: 16px 0;
            font-weight: 500;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .help-text { font-size: 13px; color: var(--text-muted); margin-top: 4px; }

        .sections-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 15px; align-items: start; }
        .section { border: 1px solid var(--border-soft); border-radius: 10px; padding: 18px; margin: 0; background: var(--panel-bg); }

        .auth-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.connected {
            background-color: #28a745;
        }

        .status-indicator.disconnected {
            background-color: #dc3545;
        }

        .sync-info {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
        }

        .pre-filled {
            background-color: #f8f9fa;
            color: #495057;
        }

        .hidden {
            display: none;
        }

        .input-row { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }

        .toggle-eye { background:#eef2f7; color:#333; border:1px solid #e3e7ef; border-radius:4px; height: var(--control-h); padding:0 12px; cursor:pointer; font-size:13px; min-width:64px; display:inline-flex; align-items:center; justify-content:center; }

        .support {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bmc-link { background-color: #FFDD00; color: #111; border: none; border-radius: 6px; padding: 8px 12px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; }
        .bmc-link:hover { filter: brightness(0.95); }

        /* Floating support button (MV3-safe replacement for BMC widget) */
        .bmc-float {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 1000;
            background-color: #5F7FFF;
            color: #fff;
            border: none;
            border-radius: 28px;
            padding: 10px 14px;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .bmc-float:hover { filter: brightness(0.95); }

        /* Tabbed layout */
        .tabs { display: flex; gap: 8px; border-bottom: 1px solid #eee; margin-bottom: 0; }
        .tab-btn { background:#f5f7fb; border:1px solid #e3e7ef; border-bottom:none; padding:8px 12px; border-top-left-radius:6px; border-top-right-radius:6px; cursor:pointer; font-weight:600; color:#333; }
        .tab-btn.active { background:#ffffff; color:#111; }
        .tab-btn.danger { background:#dc3545; color:white; border-color:#dc3545; }
        .tab-btn.danger.active { background:#c82333; color:white; }
        .tab-content { border:none; border-radius: 0; background: transparent; }
        .tab-panel { display:none; padding:0; }
        .tab-panel.active { display:block; }

        .sections-grid { display:block; }
        .section { border:1px solid var(--border-soft); border-radius:10px; padding:18px; margin:12px 0; background:#fff; }

        /* Inline row for select + button alignment */
        .inline-row { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
        .inline-row select { height: var(--control-h); }
        .inline-row .button { height: var(--control-h); padding: 0 12px; display:inline-flex; align-items:center; }

        /* Collections controls layout */
        .collections-controls {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 8px;
            align-items: center;
            margin: 8px 0;
        }

        .refresh-section {
            margin: 8px 0;
        }

        .danger-section { margin: 16px 0; padding: 16px; border: 1px solid #dc3545; border-radius: 10px; background-color: #f8d7da; }
        .collections-controls input {
            height: var(--control-h);
            padding: 0 10px;
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
        }

        .sync-settings-container.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Checkbox row layout */
        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 8px 0;
            flex-wrap: wrap;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Grid layouts */
        .sync-settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }


        /* Collections styling */
        .collections-select {
            min-width: 280px;
            display: none;
        }
        .collections-list {
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            padding: 8px;
            max-height: 240px;
            overflow: auto;
            background: #fff;
        }

        /* Hierarchical collection styling */
        .collection-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 6px;
            margin: 2px 0;
        }
        .collection-item.child {
            margin-left: 20px;
        }
        .collection-item.grandchild {
            margin-left: 40px;
        }
        .collection-checkbox {
            min-width: 16px;
        }
        .collection-checkbox.indeterminate {
            opacity: 0.7;
        }
        .collection-label {
            flex: 1;
            user-select: none;
            cursor: pointer;
        }

        /* Expand/collapse button styling */
        .expand-button {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            color: #666;
            border-radius: 2px;
            transition: all 0.2s ease;
        }
        .expand-button:hover {
            background-color: #f0f0f0;
            color: #333;
        }
        .expand-spacer {
            width: 16px;
            height: 16px;
        }

        /* Sidebar layout (alternative theme) */
        .main { display: block; }
        .sidebar { display: none; }
        .main-content { width: 100%; }

        body.layout-sidebar { padding: 0; background: #f0f2f5; }
        body.layout-sidebar .container {
            max-width: none;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            min-height: 100vh;
            /* push content below fixed header and beta notification */
            padding-top: calc(var(--header-h) + var(--notification-h));
            transition: padding-top 0.35s ease;
        }

        /* When notification is hidden, adjust padding */
        body.notification-hidden .container {
            padding-top: var(--header-h);
        }
        body.layout-sidebar .header {
            padding: 12px 20px;
            border-bottom: 1px solid #e9ecef;
            background: #fff;
            display:flex; align-items:center; justify-content: space-between;
            position: fixed; top: var(--notification-h); left: 0; right: 0; z-index: 200;
            height: var(--header-h);
            box-sizing: border-box;
            transition: top 0.35s ease;
        }
        body.layout-sidebar .main {
            display: block;
            width: 100%;
            margin: 0;
            max-width: none;
        }
        body.layout-sidebar .sidebar {
            display: flex;
            flex-direction: column;
            width: var(--sidebar-w);
            background: #ffffff;
            border-right: 1px solid #e9ecef;
            padding: 24px 16px; /* restore comfortable inner padding */
            box-sizing: border-box; /* keep total width equal to --sidebar-w */
            position: fixed; top: calc(var(--header-h) + var(--notification-h)); left: 0; bottom: 0;
            overflow-y: auto; /* scrolls within available viewport */
        }
        body.layout-sidebar .main-content {
            margin-left: var(--sidebar-w);
            width: calc(100% - var(--sidebar-w)); /* prevent horizontal overflow */
            margin-top: 0; /* flush with header */
            min-width: 0;
            padding: 24px 28px; /* restore breathing room */
            background: #f7f8fb;
            overflow: auto; /* scrolls content, keeps header & sidebar fixed */
            overflow-x: hidden; /* guard against tiny rounding overflow */
            box-sizing: border-box;
            height: calc(100vh - var(--header-h) - var(--notification-h));
        }
        body.layout-sidebar .tabs { display: none; }
        body.layout-sidebar .tab-content .section { margin: 0 0 12px 0; }

        .sidebar-section {
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            color: #2f3137;
            text-transform: uppercase;
            padding: 8px 10px;
            width: 100%;
            text-align: left;
        }
        .sidebar-title.collapsible {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }
        .sidebar-title.collapsible:hover {
            background: rgba(0,0,0,0.03);
            border-radius: 4px;
        }
        .sidebar-title .collapse-icon {
            transition: transform 0.2s;
            opacity: 0.6;
        }
        .sidebar-title.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        .sidebar-title svg {
            flex-shrink: 0;
        }
        .sidebar-links {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .sidebar-links.collapsed {
            max-height: 0;
            opacity: 0;
        }
        .side-link {
            width: 100%;
            text-align: left;
            background: transparent;
            border: none;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            color: #7a828c;
            font-weight: 400;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
        }
        .side-link .icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            opacity: 0.65;
            transition: opacity 0.2s;
        }
        .side-link:hover { background: #f1f3f5; }
        .side-link:hover .icon { opacity: 0.9; }
        .side-link.active { background: #eef2f7; color: #2f3137; }
        .side-link.active .icon { opacity: 1; }
        .side-link.danger.active, .side-link.danger { color: #dc3545; }

        /* Softer placeholders */
        input::placeholder,
        textarea::placeholder {
            color: #9aa0a6;
            opacity: 1;
        }

        /* Duplicate management styles */
        .badge {
            background: #007bff;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        .duplicate-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: #fff;
        }
        .duplicate-group {
            border-bottom: 1px solid #e9ecef;
            padding: 12px;
        }
        .duplicate-group:last-child {
            border-bottom: none;
        }
        .duplicate-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px solid #f1f3f5;
        }
        .duplicate-item:last-child {
            border-bottom: none;
        }
        .duplicate-item input[type="checkbox"] {
            margin: 0;
        }
        .duplicate-url {
            font-size: 12px;
            color: #6c757d;
            margin-top: 2px;
        }
        .duplicate-location {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }

        /* Inline modal for confirmations */
        .inline-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 400;
        }
        .inline-modal.visible {
            display: flex;
        }
        .inline-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.35);
            backdrop-filter: blur(2px);
        }
        .inline-modal-dialog {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            width: min(440px, calc(100% - 32px));
            padding: 20px 22px 18px 22px;
            box-shadow: 0 18px 48px rgba(15, 23, 42, 0.18);
            animation: modal-pop 0.24s ease;
        }
        @keyframes modal-pop {
            from { transform: translateY(12px) scale(0.97); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        .inline-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 12px;
        }
        .inline-modal-header h3 {
            margin: 0;
            font-size: 17px;
            color: #1f2937;
        }
        .inline-modal-body {
            font-size: 14px;
            color: #4b5563;
            line-height: 1.45;
            margin-bottom: 18px;
            white-space: pre-line;
        }
        .inline-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .button-icon {
            border: none;
            background: transparent;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            color: #9ca3af;
            padding: 2px 4px;
        }
        .button-icon:hover {
            color: #4b5563;
        }
        body.modal-open {
            overflow: hidden;
        }

        /* Children container styling */
        .collection-children {
            transition: all 0.3s ease;
        }
        .collection-children[style*="display: none"] {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }

        .button.small {
            padding: 0 16px;
            font-size: 12px;
            white-space: nowrap;
        }

        .support-text { font-size: 14px; color: #444; line-height: 1.6; }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--btn-primary-bg, var(--accent));
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button.loading {
            position: relative;
            color: transparent;
        }

        .button.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #007cba;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Auth status enhancements */
        .auth-status.checking {
            opacity: 0.7;
        }

        .status-details {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Enhanced error states */
        .error-details {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            font-size: 13px;
            color: #721c24;
        }

        .error-details summary {
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .error-details ul {
            margin: 8px 0 0 20px;
            padding: 0;
        }

        .warning-icon, .info-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 6px;
            vertical-align: text-top;
        }

        /* Support page styling */
        .support-section {
            margin: 24px 0;
            padding: 16px 0;
            border-bottom: 1px solid #eee;
        }
        .support-section:last-child {
            border-bottom: none;
        }
        .support-section h3 {
            margin: 0 0 16px 0;
            font-size: 16px;
            color: #333;
        }
        .support-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        /* Theme-driven button overrides (global) */
        .button {
            background-color: var(--btn-normal-bg) !important;
            color: var(--btn-normal-fg, #111) !important;
            border: 1px solid var(--btn-normal-border, transparent) !important;
            transition: background-color .2s ease, border-color .2s ease, color .2s ease;
        }
        .button:hover { background-color: var(--btn-normal-hover, var(--btn-normal-bg)) !important; }
        .button.secondary {
            background-color: var(--btn-secondary-bg, var(--btn-normal-bg)) !important;
            color: var(--btn-secondary-fg, var(--btn-normal-fg, #111)) !important;
            border-color: var(--btn-secondary-border, var(--btn-normal-border, transparent)) !important;
        }
        .button.secondary:hover { background-color: var(--btn-secondary-hover, var(--btn-secondary-bg)) !important; }
        .button.primary { background-color: var(--btn-primary-bg, var(--accent)) !important; color: var(--btn-primary-fg, #fff) !important; border-color: var(--btn-primary-border, transparent) !important; }
        .button.primary:hover { background-color: var(--btn-primary-hover, var(--accent-hover)) !important; }
        .button.warning { background-color: var(--btn-warning-bg, #f59e0b) !important; color: var(--btn-warning-fg, #fff) !important; }
        .button.warning:hover { background-color: var(--btn-warning-hover, #d97706) !important; }
        .button.danger, .button.critical { background-color: var(--btn-critical-bg, #dc3545) !important; color: var(--btn-critical-fg, #fff) !important; }
        .button.danger:hover, .button.critical:hover { background-color: var(--btn-critical-hover, #c82333) !important; }

        /* Primary header links also follow theme primary color */
        .header-link.primary { background: var(--btn-primary-bg, var(--accent)) !important; color: var(--btn-primary-fg, #fff) !important; border-color: var(--accent-strong) !important; }
        .header-link.primary:hover { background: var(--btn-primary-hover, var(--accent-hover)) !important; }

        /* Header actions */
        .header { display:flex; align-items:center; justify-content: space-between; }
        .header-actions { display:flex; align-items:center; gap:8px; }
        .header-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        .header-link .icon {
            width: 14px;
            height: 14px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .header-link:hover {
            background: #e9ecef;
            border-color: #dee2e6;
            transform: translateY(-1px);
        }
        .header-link:hover .icon {
            opacity: 1;
        }
        .header-link.primary {
            background: #007cba;
            border-color: #006ba3;
            color: white;
        }
        .header-link.primary:hover {
            background: #006ba3;
            border-color: #005a87;
        }
        /* ---- Theme variables and overrides ---- */
        :root {
            --accent: #007cba; /* default primary */
            --accent-hover: #005a87;
            --accent-strong: #006ba3;
            --danger: #dc3545;
            /* Default button mapping (Original) */
            --btn-normal-bg: #f5f7fb;
            --btn-normal-fg: #333;
            --btn-normal-hover: #e9eef8;
            --btn-primary-bg: var(--accent);
            --btn-primary-fg: #fff;
            --btn-primary-hover: var(--accent-hover);
            --btn-secondary-bg: #e9ecef;
            --btn-secondary-fg: #333;
            --btn-secondary-hover: #dee2e6;
            --btn-critical-bg: #dc3545;
            --btn-critical-fg: #fff;
            --btn-critical-hover: #c82333;
            --btn-warning-bg: #f59e0b;
            --btn-warning-fg: #fff;
            --btn-warning-hover: #d97706;
        }
        /* Minimal Professional Themes - Muted & Sophisticated */

        /* Slate - Professional Gray (Default) */
        [data-theme="slate"] {
            --accent: #64748b;
            --accent-hover: #475569;
            --accent-strong: #334155;
            --btn-normal-bg: #f8fafc;
            --btn-normal-fg: #334155;
            --btn-normal-hover: #f1f5f9;
            --btn-primary-bg: #64748b;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #475569;
            --btn-secondary-bg: #e2e8f0;
            --btn-secondary-fg: #475569;
            --btn-secondary-hover: #cbd5e1;
        }

        /* Charcoal - Sophisticated Dark */
        [data-theme="charcoal"] {
            --accent: #52525b;
            --accent-hover: #3f3f46;
            --accent-strong: #27272a;
            --btn-normal-bg: #fafafa;
            --btn-normal-fg: #27272a;
            --btn-normal-hover: #f4f4f5;
            --btn-primary-bg: #52525b;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #3f3f46;
            --btn-secondary-bg: #e4e4e7;
            --btn-secondary-fg: #3f3f46;
            --btn-secondary-hover: #d4d4d8;
        }

        /* Ocean - Muted Blue-Gray */
        [data-theme="ocean"] {
            --accent: #5b7c99;
            --accent-hover: #456073;
            --accent-strong: #34495e;
            --btn-normal-bg: #f7f9fb;
            --btn-normal-fg: #2c3e50;
            --btn-normal-hover: #ecf0f3;
            --btn-primary-bg: #5b7c99;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #456073;
            --btn-secondary-bg: #dfe6ed;
            --btn-secondary-fg: #456073;
            --btn-secondary-hover: #d0dae3;
        }

        /* Dark mode overrides - Anthracite Gray Theme */
        :root[data-color-mode="dark"] {
            --panel-bg: #2d2d2d;
            --text: #e8e8e8;
            --text-muted: #9a9a9a;
            --border-soft: #404040;
        }
        :root[data-color-mode="dark"] body { background-color: #1a1a1a; color: var(--text); }
        :root[data-color-mode="dark"] .header { background: #252525; border-bottom-color: #404040; }
        :root[data-color-mode="dark"] .sidebar { background: #252525; border-right-color: #404040; }
        :root[data-color-mode="dark"] .main-content { background: #222222; }
        :root[data-color-mode="dark"] .header-link { background: #2d2d2d; border-color: #404040; color: #e8e8e8; }
        :root[data-color-mode="dark"] .header-link:hover { background: #383838; border-color: #4a4a4a; }
        :root[data-color-mode="dark"] .tab-btn { background: #2d2d2d; border-color: #404040; color: #e8e8e8; }
        :root[data-color-mode="dark"] .tab-btn.active { background: #222222; color: #ffffff; }
        :root[data-color-mode="dark"] .section { background: var(--panel-bg); border-color: var(--border-soft); }
        :root[data-color-mode="dark"] .help-text { color: var(--text-muted); }
        :root[data-color-mode="dark"] input, :root[data-color-mode="dark"] select, :root[data-color-mode="dark"] .toggle-eye { background-color: #2a2a2a; color: #e8e8e8; border-color: #404040 !important; }
        :root[data-color-mode="dark"] .button.secondary { background-color: #3d3d3d; color: #e8e8e8; }
        :root[data-color-mode="dark"] .status.success { background: #1e3a1e; color: #86efac; border-color: #2d5a2d; }
        :root[data-color-mode="dark"] .status.error { background: #3a1e1e; color: #fecaca; border-color: #5a2d2d; }
        :root[data-color-mode="dark"] .status.info { background: #1e2a3a; color: #7dd3fc; border-color: #2d3d5a; }

        /* Apply theme accents only to explicitly marked primary actions */
        .button.primary { background-color: var(--accent) !important; }
        .button.primary:hover { background-color: var(--accent-hover) !important; }
        /* Warning variant for attention but non-destructive actions */
        .button.warning { background-color: #f59e0b; color: #fff; }
        .button.warning:hover { background-color: #d97706; }
        .header-link.primary { background: var(--accent); border-color: var(--accent-strong); color: #fff; }
        .header-link.primary:hover { background: var(--accent-strong); border-color: var(--accent-hover); }
        #toggleManagedOAuth, #toggleManualConfig { border-color: var(--accent) !important; color: var(--accent) !important; }
        input[type="text"]:focus,
        input[type="url"]:focus,
        input[type="password"]:focus { border-color: var(--accent) !important; }
        /* Keep section borders as originally designed; do not force accent */
        /* In non-sidebar layout, push content down when notification is visible */
        body:not(.layout-sidebar) .container {
            /* keep side paddings from base .container, only adjust top */
            padding-top: calc(24px + var(--notification-h));
            transition: padding-top 0.35s ease;
        }
    </style>
</head>
<body class="layout-sidebar">
    <!-- Beta Software Notification Bar - Professional Design -->
    <div id="betaNotificationBar" class="notification-bar notification-bar-modern">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div class="notification-icon-box">
                <img src="icons/notification.svg" alt="" class="icon">
            </div>
            <div>
                <div class="notification-title">Beta Software Notice</div>
                <div class="notification-subtitle">Always backup your bookmarks before making changes</div>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <button id="quickBackupBtn" class="notification-btn" title="Create backup now">
                <img src="icons/layers.svg" alt="" class="icon" style="margin-right: 6px; width: 14px; height: 14px;">
                Backup Now
            </button>
            <button id="closeBetaNotificationBar" class="notification-close" title="Close notification">×</button>
        </div>
    </div>

    <!-- Alternative Beta Notification Bar - Minimal Design (hidden by default) -->
    <div id="betaNotificationBarAlt" class="notification-bar notification-bar-minimal" style="display: none;">
        <div style="display: flex; align-items: center; gap: 8px;">
            <img src="icons/notification.svg" alt="" class="icon" style="width: 14px; height: 14px; opacity: 1;">
            <span><strong>Beta Software:</strong> Always backup your bookmarks before making changes</span>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <button id="quickBackupBtnAlt" class="notification-btn" title="Create backup now">Backup</button>
            <button id="closeBetaNotificationBarAlt" class="notification-close" title="Close notification">×</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 16px;">
                <h1>Open Bookmark Sync</h1>
                <div id="nextSyncCountdown" style="font-size: 13px; color: #666; display: none;">
                    Next sync in: <span id="countdownTimer" style="font-weight: 600; color: var(--accent);">--:--</span>
                </div>
                <div id="quickStatusBadges" style="display: flex; gap: 6px; font-size: 11px;">
                    <span id="quietHoursBadge" style="display: none; background: #f59e0b; color: white; padding: 3px 8px; border-radius: 12px; font-weight: 600;">🌙 Quiet</span>
                    <span id="lowBatteryBadge" style="display: none; background: #dc3545; color: white; padding: 3px 8px; border-radius: 12px; font-weight: 600;">🔋 Low</span>
                    <span id="meteredBadge" style="display: none; background: #0dcaf0; color: white; padding: 3px 8px; border-radius: 12px; font-weight: 600;">📶 Metered</span>
                </div>
            </div>
            <div class="header-actions">
                <a id="siteLink" class="header-link" href="#" target="_blank" rel="noopener noreferrer">
                    <img src="icons/home.svg" alt="" class="icon">
                    <span>Website</span>
                </a>
                <a href="mailto:dagkan@spacechild.dev?subject=Raindrop%20Browser%20Sync%20-%20Issue%20Report&body=Hi%2C%0A%0AI%20found%20an%20issue%20with%20the%20Raindrop%20Browser%20Sync%20extension%3A%0A%0A%5BPlease%20describe%20the%20issue%20here%5D%0A%0AThanks%21" class="header-link">
                    <img src="icons/mail.svg" alt="" class="icon">
                    <span>Report Issue</span>
                </a>
                <a href="https://github.com/sponsors/spacechild-dev" class="header-link primary" target="_blank" rel="noopener noreferrer">
                    <img src="icons/heart.svg" alt="" class="icon">
                    <span>Sponsor</span>
                </a>
            </div>
        </div>

        

        <div class="main">
            <nav class="sidebar" aria-label="Sidebar Navigation">
                <!-- Raindrop.io Sync - Always visible -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Raindrop.io Sync</div>
                    <div class="sidebar-links">
                        <button class="side-link" data-tab="api">
                            <img src="icons/connect.svg" alt="" class="icon">
                            Connect
                        </button>
                        <button class="side-link" data-tab="sync">
                            <img src="icons/sync.svg" alt="" class="icon">
                            Sync Settings
                        </button>
                    </div>
                </div>

                <!-- AI Organization - TEMPORARILY DISABLED -->
                <!--
                <div class="sidebar-section">
                    <div class="sidebar-title">AI Organization</div>
                    <div class="sidebar-links">
                        <button class="side-link" data-tab="ai">
                            <img src="icons/ai.svg" alt="" class="icon">
                            AI Organizer
                        </button>
                    </div>
                </div>
                -->

                <!-- More - Collapsible -->
                <div class="sidebar-section">
                    <div class="sidebar-title collapsible" data-section="more">
                        <span>More</span>
                        <img src="icons/chevron.svg" alt="" class="collapse-icon" style="width: 10px; height: 10px;">
                    </div>
                    <div class="sidebar-links" data-links="more">
                        <button class="side-link" data-tab="tools">
                            <img src="icons/tools.svg" alt="" class="icon">
                            Tools
                        </button>
                        <button class="side-link" data-tab="general">
                            <img src="icons/settings.svg" alt="" class="icon">
                            Settings
                        </button>
                        <button class="side-link" data-tab="help">
                            <img src="icons/help.svg" alt="" class="icon">
                            Help
                        </button>
                    </div>
                </div>
                <div style="padding: 16px 10px; margin-top: auto; border-top: 1px solid #e9ecef;">
                    <div style="font-size: 11px; color: #6c757d; text-align: center;">
                        <div style="margin-bottom: 4px;">Open Bookmark Sync</div>
                        <div style="font-weight: 600;">v1.3.0</div>
                    </div>
                </div>
            </nav>

            <!-- Floating Action Buttons -->
            <div id="floatingActions" style="position: fixed; bottom: 24px; right: 32px; display: flex; flex-direction: column; gap: 12px; z-index: 1000;">
                <button id="fabSync" class="button btn-lg primary" title="Sync Now (Ctrl+S)" style="box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    <img src="icons/sync.svg" alt="" style="width: 16px; height: 16px; filter: brightness(0) invert(1); margin-right: 8px;">
                    Sync Now
                </button>
                <button id="fabBackup" class="button btn-lg secondary" title="Backup Now (Ctrl+B)" style="box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    <img src="icons/layers.svg" alt="" style="width: 16px; height: 16px; margin-right: 8px;">
                    Backup Now
                </button>
            </div>

            <div class="main-content">
                <div class="tab-content">
        <div id="statusMessage" class="status hidden" style="position: sticky; top: 0; z-index: 5; margin: 0 0 10px 0;"></div>


        <!-- Closeable Privacy Notice -->
        <div id="privacyNotice" class="section" style="border: 1px solid #e8f4f8; background: #f8fcff; margin-bottom: 16px; display: block;">
            <div style="display: flex; align-items: flex-start; justify-content: space-between;">
                <div>
                    <h3 style="margin: 0 0 8px 0; color: #0066cc;">🔒 Privacy & Security</h3>
                    <div class="help-text" style="margin: 0;">
                        <strong>No telemetry or tracking:</strong> This extension does not collect any usage data, analytics, or personal information.
                        All data stays on your device and your chosen sync service (Raindrop.io).
                        Authentication tokens are stored locally in Chrome's secure storage.
                    </div>
                </div>
                <button id="closePrivacyNotice" type="button" style="background: none; border: none; font-size: 18px; color: #666; cursor: pointer; padding: 4px; margin-left: 12px;" title="Close privacy notice">×</button>
            </div>
        </div>

        <div class="section tab-panel active" id="tab-api" data-tab="api">
            <h2>Authentication</h2>

            <div id="authMethodGroup" class="form-group">
                <label for="authMethod">Authentication Method</label>
                <select id="authMethod">
                    <option value="managed" selected>Managed OAuth (Recommended)</option>
                    <option value="manual">Manual Configuration</option>
                </select>
                <div class="help-text">Choose how to authenticate with Raindrop.io. Managed OAuth is safer and easier.</div>
            </div>
            <div id="authStatus" class="auth-status">
                <div id="statusIndicator" class="status-indicator disconnected"></div>
                <span id="authStatusText">Not authenticated</span>
                <div id="statusDetails" class="status-details hidden"></div>
                <div id="authProgress" class="progress-bar hidden">
                    <div id="authProgressFill" class="progress-bar-fill"></div>
                </div>
            </div>
            <div id="authButtons" style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                <button id="authenticateBtn" class="button">Authenticate with Raindrop</button>
                <button id="testConnection" class="button secondary">Test Connection</button>
                <button id="logout" class="button danger hidden">Logout</button>
            </div>

            <div id="managedOAuthSection" style="margin-top: 16px; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #fafbfc;">
                <div id="managedOAuthHeader" style="display: flex; align-items: center; justify-content: space-between;">
                    <div id="managedOAuthTitle">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <h3 style="margin: 0 0 4px 0; font-size: 14px;">Managed OAuth Settings</h3>
                            <div id="workerStatusContainer">
                                <span id="workerStatus" class="help-text"></span>
                            </div>
                        </div>
                        <span class="help-text" style="margin: 0;">Advanced configuration for managed authentication</span>
                    </div>
                    <button id="toggleManagedOAuth" type="button" style="background: none; border: 1px solid #007cba; color: #007cba; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                        Show
                    </button>
                </div>

                <div id="managedOAuthDetails" class="hidden" style="margin-top: 12px;">
            <div class="form-group">
              <label for="managedOAuthBaseUrl">Auth Server URL</label>
              <input type="url" id="managedOAuthBaseUrl" placeholder="https://rdoauth.daiquiri.dev" class="pre-filled" disabled>
              <div class="help-text">Using secure managed authentication server</div>
                </div>
            </div>
            <div id="manualConfigSection" style="margin-top: 16px; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #fafbfc;">
                <div id="manualConfigHeader" style="display: flex; align-items: center; justify-content: space-between;">
                    <div id="manualConfigTitle">
                        <h3 style="margin: 0 0 4px 0; font-size: 14px;">Manual Configuration</h3>
                        <span class="help-text" style="margin: 0;">For advanced users or direct authentication setup</span>
                    </div>
                    <button id="toggleManualConfig" type="button" style="background: none; border: 1px solid #007cba; color: #007cba; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                        Show
                    </button>
                </div>

                <div id="manualConfigDetails" class="hidden" style="margin-top: 12px;">
                <div id="clientIdGroup" class="form-group">
                    <label for="clientId">Client ID</label>
                    <div class="input-row">
                        <input type="password" id="clientId" placeholder="Enter your Raindrop Client ID">
                        <button id="toggleClientId" type="button" class="toggle-eye" aria-label="Show/Hide">Show</button>
                    </div>
                    <div class="help-text">Stored locally via Chrome storage. Hidden by default for privacy.</div>
                </div>

                <div id="clientSecretGroup" class="form-group">
                    <label for="clientSecret">Client Secret</label>
                    <div class="input-row">
                        <input type="password" id="clientSecret" placeholder="Enter your Raindrop Client Secret">
                        <button id="toggleClientSecret" type="button" class="toggle-eye" aria-label="Show/Hide">Show</button>
                    </div>
                    <div class="help-text">Do not share your client secret.</div>
                </div>

                <div id="redirectUriGroup" class="form-group">
                    <label for="redirectUri">Redirect URI</label>
                    <div class="input-row">
                        <input type="url" id="redirectUri" class="pre-filled" placeholder="Extension identity redirect (auto)">
                        <button id="redirectReset" type="button" class="toggle-eye" aria-label="Reset to default">Reset</button>
                    </div>
                    <div class="help-text">Default is the extension identity URL (auto). You can override this for beta testing; ensure it matches what you registered in Raindrop.</div>
                    <div id="redirectHint" class="help-text" style="margin-top:6px;"></div>
                </div>
                <div id="saveConfigSection" style="margin-top: 16px;">
                    <button id="saveConfig" class="button">Save Configuration</button>
                </div>
                </div>
            </div>

            <div id="debugSection" class="section" style="margin-top:16px;">
                <h3>Debug</h3>
                <div id="debugButtons" style="display:flex; gap:8px; flex-wrap:wrap;">
                    <button id="viewAuthState" class="button secondary" type="button">View Auth State</button>
                    <button id="runHealthCheck" class="button secondary" type="button">Run Health Check</button>
                    <button id="clearTokens" class="button danger" type="button">Clear Tokens</button>
                </div>
                <pre id="authStateOut" style="background:#f8f9fa; border:1px solid #e6e9ef; padding:10px; border-radius:6px; margin-top:8px; max-height:220px; overflow:auto;"></pre>
            </div>
        </div>

        <div class="section tab-panel" id="tab-sync" data-tab="sync">
            <h2>Sync Settings</h2>

            <!-- Raindrop Protection Notice -->
            <div class="section" style="border: 1px solid #10b981; background: #ecfdf5; margin-bottom: 16px; padding: 12px; border-radius: 6px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="color: #047857; font-size: 16px;">🛡️</span>
                    <div>
                        <h3 style="margin: 0 0 4px 0; color: #047857; font-size: 14px;">Raindrop Protection Active</h3>
                        <div class="help-text" style="margin: 0; color: #047857;">
                            This extension never deletes bookmarks from Raindrop.io. Your Raindrop collection is always safe.
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-row">
                    <label class="checkbox-label">
                        <input type="checkbox" id="syncEnabled">
                        <strong>Enable Raindrop Sync</strong>
                    </label>
                </div>
                <div class="help-text">When disabled, automatic sync stops and manual sync is blocked.</div>
            </div>

            <div id="syncSettings" class="sync-settings-container">
                <div class="sync-info" style="margin-bottom:12px;">
                    <div id="autoSyncInfo">Automatic sync: Every 5 minutes</div>
                    <div id="lastSyncTime">Last sync: Never</div>
                </div>

            <div class="sync-settings-grid">
                <div class="form-group">
                    <label for="syncInterval">Sync interval (minutes)</label>
                    <input type="number" id="syncInterval" min="1" step="1" placeholder="5">
                    <div class="help-text">Minimum 1 minute. Alarm is rescheduled automatically.</div>
                </div>

                <div class="form-group">
                    <label for="rateLimitRpm">Max requests per minute</label>
                    <input type="number" id="rateLimitRpm" min="1" step="1" placeholder="60">
                    <div class="help-text">Used to pace API calls and avoid rate limit (429). Backoff applies automatically.</div>
                </div>
            </div>

            <div class="form-group">
                <label for="syncModeSelect">Sync mode</label>
                <select id="syncModeSelect">
                    <option value="additions_only">Two-way: Additions only</option>
                    <option value="mirror">Two-way: Mirror (add/update, no deletes)</option>
                    <option value="upload_only">One-way: Browser → Raindrop (additions only)</option>
                    <option value="off" selected>One-way: Raindrop → Browser (rebuild)</option>
                </select>
                <div class="help-text">Controls direction and level of reconciliation. Extension never deletes from Raindrop for safety.</div>
            </div>

            <div class="form-group collections-block">
                <label>Collections to import</label>
                <div class="help-text">Choose which Raindrop collections to import.</div>

                <!-- Collection Import Mode Selection -->
                <div style="margin: 12px 0;">
                    <label for="collectionModeSelect" style="display: block; margin-bottom: 6px; font-weight: 600;">Import Mode:</label>
                    <select id="collectionModeSelect" style="width: 100%; height: 35px; padding: 0 10px; border: 1px solid #d7dbe2; border-radius: 4px; font-size: 13px; margin-bottom: 8px;">
                        <option value="topLevel" selected>Top-level only (Recommended - Safer and faster)</option>
                        <option value="custom">Custom selection (Advanced - Choose specific collections)</option>
                        <option value="all">All collections (Import everything including sub-collections)</option>
                    </select>
                    <div id="collectionModeDescription" class="help-text" style="margin-top: 4px;">Import only parent collections, excluding sub-collections. Safer and faster.</div>
                </div>
                <div class="refresh-section">
                    <button id="refreshCollections" class="button secondary" type="button">Refresh Collections & Folders</button>
                </div>
                <!-- Custom Selection Controls (shown only when Custom mode is selected) -->
                <div id="customCollectionControls" style="display: none;">
                    <div class="collections-controls">
                        <input type="text" id="collectionsSearch" placeholder="Search collections" disabled />
                        <button id="selectAllCollections" class="button secondary small" type="button" disabled>Select all</button>
                        <button id="clearCollections" class="button secondary small" type="button" disabled>Clear</button>
                    </div>
                    <div id="collectionsList" class="collections-list"></div>
                </div>
                <div class="help-text">Select specific collections to import. Only available when "Top-level only" is disabled.</div>
            </div>

            <div class="form-group">
                <label for="targetFolderSelect">Target bookmarks folder</label>
                <select id="targetFolderSelect"></select>
                <div class="help-text">Items sync directly under the selected folder (default: Bookmarks Bar).</div>
            </div>

            <h2>Sorting Options</h2>

            <div class="form-group">
                <label for="collectionsSortSelect">Collections order</label>
                <select id="collectionsSortSelect">
                    <option value="alpha_asc">Alphabetical (A → Z)</option>
                    <option value="alpha_desc">Alphabetical (Z → A)</option>
                    <option value="raindrop">Raindrop order (if available)</option>
                    <option value="none">Do not reorder</option>
                </select>
                <div class="help-text">Applies to collection folders at the target root.</div>
            </div>

            <div class="form-group">
                <label for="bookmarksSortSelect">Bookmarks order</label>
                <select id="bookmarksSortSelect">
                    <option value="created_desc">Newest first</option>
                    <option value="created_asc">Oldest first</option>
                    <option value="alpha_asc">Alphabetical (A → Z)</option>
                    <option value="alpha_desc">Alphabetical (Z → A)</option>
                    <option value="domain_asc">Domain (A → Z)</option>
                    <option value="none">Do not reorder</option>
                </select>
                <div class="help-text">Applies to bookmarks inside each collection folder.</div>
            </div>

            <div class="form-group" style="margin-top: 12px;">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button id="syncNow" class="button">Sync Now</button>
                    <button id="retrySyncBtn" class="button warning" style="display: none;">🔄 Retry</button>
                </div>
                <div class="progress-container" id="syncProgress">
                    <div class="progress-bar" id="syncProgressBar" style="width: 0%;">0%</div>
                </div>
                <div id="syncMetrics" style="margin-top: 8px; font-size: 12px; color: #666; display: none;">
                    Last sync: <span id="lastSyncStats">--</span>
                </div>
            </div>
            </div> <!-- end syncSettings container -->
        </div>

        <!-- AI Organizer Tab -->
        <div class="section tab-panel" id="tab-ai" data-tab="ai">
            <h2>🤖 AI Bookmark Organizer</h2>
            <p class="help-text">Use AI to intelligently organize, clean, and categorize your bookmarks.</p>

            <!-- AI Provider Configuration -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <h3>🔑 AI Provider Settings</h3>

                <div class="form-group">
                    <label for="aiProvider">AI Provider</label>
                    <select id="aiProvider">
                        <option value="">-- Select Provider --</option>
                        <option value="claude">Claude (Anthropic)</option>
                        <option value="openai">OpenAI (GPT-4)</option>
                        <option value="gemini">Google Gemini</option>
                    </select>
                    <div class="help-text">
                        Choose your preferred AI service. Each provider's API key is saved separately.
                        <span id="savedProvidersHint" style="display: none; color: #28a745; font-weight: 600;"></span>
                    </div>
                </div>

                <div id="aiProviderConfig" class="hidden">
                    <div class="form-group">
                        <label for="aiApiKey">API Key</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="password" id="aiApiKey" placeholder="Enter your API key" style="flex: 1;">
                            <button type="button" id="toggleApiKey" class="button secondary small">Show</button>
                        </div>
                        <div class="help-text" id="apiKeyHelp">
                            Get your API key from: <a href="#" id="apiKeyLink" target="_blank" rel="noopener noreferrer">Provider website</a>
                            <span id="apiKeyFormat" style="display: none; margin-left: 8px;">• Format: <code id="apiKeyFormatText"></code></span>
                        </div>
                    </div>

                    <div class="form-group" id="aiModelGroup">
                        <label for="aiModel">Model</label>
                        <select id="aiModel">
                            <option value="">-- Select Model --</option>
                        </select>
                        <div class="help-text">Choose the AI model to use for analysis.</div>
                    </div>

                    <div style="display: flex; gap: 8px;">
                        <button type="button" id="saveAiConfig" class="button">Save Configuration</button>
                        <button type="button" id="testAiConnection" class="button secondary">Test Connection</button>
                    </div>

                    <div id="aiConfigStatus" class="status hidden"></div>
                </div>
            </div>

            <!-- AI Analysis Tools -->
            <div id="aiToolsSection" class="hidden">
                <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <h3>📊 Smart Analysis</h3>

                    <div class="form-group">
                        <label>Select Bookmark Source</label>
                        <select id="aiAnalysisSource">
                            <option value="all">All Bookmarks</option>
                            <option value="folder">Specific Folder</option>
                            <option value="unsorted">Unsorted Only</option>
                        </select>
                    </div>

                    <div id="aiFolderSelect" class="form-group hidden">
                        <label for="aiTargetFolder">Target Folder</label>
                        <select id="aiTargetFolder"></select>
                    </div>

                    <div class="form-group">
                        <label>Analysis Types</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="aiAnalyzeDomain" checked>
                                <span>Domain Grouping - Group by website/domain</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="aiAnalyzeTopic" checked>
                                <span>Topic Categorization - Identify topics and categories</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="aiAnalyzeSimilar" checked>
                                <span>Similarity Detection - Find related bookmarks</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="aiAnalyzeDuplicates" checked>
                                <span>Duplicate Detection - Find exact and near duplicates</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="aiAnalyzeBroken">
                                <span>Broken Links - Check for dead/invalid URLs</span>
                            </label>
                        </div>
                    </div>

                    <button type="button" id="startAiAnalysis" class="button btn-lg" style="width: 100%; margin-top: 12px;">
                        🔍 Analyze Bookmarks
                    </button>
                </div>

                <!-- Results Section -->
                <div id="aiResultsSection" class="hidden">
                    <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                        <h3>📋 Analysis Results</h3>

                        <div id="aiProgress" class="hidden" style="margin: 16px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span id="aiProgressText">Analyzing...</span>
                                <span id="aiProgressPercent">0%</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                                <div id="aiProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s;"></div>
                            </div>
                        </div>

                        <div id="aiResultsContent"></div>

                        <div id="aiResultsActions" class="hidden" style="display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap;">
                            <button type="button" id="applyAiSuggestions" class="button">Apply All Suggestions</button>
                            <button type="button" id="exportAiResults" class="button secondary">Export Results</button>
                            <button type="button" id="clearAiResults" class="button secondary small">Clear</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-tools" data-tab="tools">
            <h2>🛠️ Tools</h2>
            <p class="help-text">Import, export, backup, and cleanup utilities for managing your bookmarks.</p>

            <!-- Import & Export Section -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <h3>📥 Import & Export</h3>

                <div style="margin: 12px 0;">
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Export Bookmarks</h4>
                    <button id="exportBookmarks" class="button secondary" type="button">Export All Bookmarks (JSON)</button>
                    <div class="help-text" style="margin-top: 4px;">Downloads all your bookmarks as a JSON file for backup or transfer.</div>
                </div>

                <div style="margin: 12px 0;">
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Import Bookmarks</h4>
                    <input type="file" id="importFile" accept=".json,.html,.htm" style="margin-bottom: 8px;" />
                    <button id="importBookmarks" class="button secondary" type="button" disabled>Import Bookmarks</button>
                    <div class="help-text" style="margin-top: 4px;">
                        Supports JSON (Chrome/Brave exports) and HTML (standard browser exports)
                    </div>
                </div>

                <div style="margin: 12px 0; padding: 12px; border: 1px solid #f59e0b; background: #fffbeb; border-radius: 6px;">
                    <h4 style="font-size: 14px; margin-bottom: 8px; color: #92400e;">⚠️ Emergency Restore</h4>
                    <button id="emergencyRestore" class="button danger" type="button">Emergency Restore (Clear All + Restore)</button>
                    <div class="help-text" style="color: #92400e; margin-top: 4px;">
                        <strong>Use only if bookmarks are corrupted:</strong> This will delete ALL current bookmarks and restore from a backup file.
                    </div>
                </div>
            </div>

            <!-- Backup & Restore Section -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <h3>💾 Backup & Restore</h3>

                <div style="margin: 12px 0;">
                    <h4 style="font-size: 14px; margin-bottom: 8px;">📚 Backup Version History</h4>
                    <div id="backupVersionHistory" style="padding: 12px; border: 1px solid #e9ecef; border-radius: 6px; background: #f8f9fa; max-height: 300px; overflow-y: auto;">
                        <div class="help-text">Loading backup history...</div>
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px;">
                        <button id="refreshBackupHistory" class="button secondary" type="button">🔄 Refresh</button>
                        <button id="compareBackups" class="button secondary" type="button" style="display: none;">📊 Compare Selected</button>
                        <button id="clearOldAutoBackups" class="button secondary" type="button">🗑️ Clear Old</button>
                    </div>
                </div>

                <div style="margin: 12px 0;">
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Manual Backup & Restore</h4>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button id="createBackup" class="button primary" type="button">Create Backup</button>
                        <button id="downloadBackupFile" class="button secondary" type="button">Download Backup</button>
                        <button id="restoreFromBackup" class="button secondary" type="button">Restore from File</button>
                    </div>
                    <input type="file" id="restoreBackupFile" accept=".json" style="display: none;" />
                    <div class="help-text" style="margin-top: 4px;">Create manual backup or restore from a previous backup file.</div>
                </div>

                <div style="margin: 12px 0; padding: 12px; border: 1px solid #10b981; background: #ecfdf5; border-radius: 6px;">
                    <h4 style="font-size: 14px; margin-bottom: 8px; color: #047857;">Emergency Recovery</h4>
                    <button id="restoreLastBackup" class="button" style="background: #28a745;" type="button">Restore Latest Auto Backup</button>
                    <div class="help-text" style="color: #047857; margin-top: 4px;">Use this if sync operations go wrong and you need to quickly restore your bookmarks.</div>
                </div>
            </div>

            <!-- Cleanup Section -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px;">
                <h3>🔍 Cleanup & Maintenance</h3>

                <div id="duplicateStatus" style="padding: 12px; border: 1px solid #e9ecef; border-radius: 6px; background: #f8f9fa; margin: 12px 0;">
                    <div id="duplicateStatusText">Click "Scan for Duplicates" to analyze your bookmarks</div>
                </div>

                <div style="display: grid; gap: 12px; grid-template-columns: 1fr 1fr; margin: 12px 0;">
                    <div>
                        <button id="scanDuplicates" class="button" style="background: #0066cc; width: 100%;" type="button">Scan for Duplicates</button>
                        <div class="help-text" style="font-size: 11px; margin-top: 4px;">Find duplicate bookmarks and folders</div>
                    </div>
                    <div>
                        <button id="cleanUrlParameters" class="button secondary" style="width: 100%;" type="button">Clean URL Parameters</button>
                        <div class="help-text" style="font-size: 11px; margin-top: 4px;">Remove UTM, fbclid tracking parameters</div>
                    </div>
                </div>

                <div style="margin: 12px 0;">
                    <button id="cleanEmptyFolders" class="button secondary" style="width: 100%;" type="button">Clean Empty Folders</button>
                    <div class="help-text" style="margin-top: 4px;">Remove empty bookmark folders to keep your organization clean.</div>
                </div>

                <div id="duplicatePreview" class="hidden" style="margin: 16px 0; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #f8f9fa;">
                    <h4 style="color: #333; margin: 0 0 12px 0;">Duplicate Analysis Results</h4>
                    <div id="duplicateResults"></div>
                    <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button id="autoCleanupSelected" class="button" type="button" style="background: var(--accent); color: white;">Auto Cleanup All</button>
                        <button id="manualMergeSelected" class="button secondary" type="button">Manual Merge</button>
                        <button id="cancelScan" class="button secondary" type="button">Cancel</button>
                    </div>
                </div>

                <div style="margin: 16px 0;">
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Scan Options</h4>
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="checkbox" id="includeSubfolders" checked>
                        <span>Include subfolders in scan</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="checkbox" id="exactTitleMatch">
                        <span>Require exact title match for bookmarks</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="createBackupBeforeRemoval" checked>
                        <span>Automatically create backup before any changes</span>
                    </label>
                </div>
            </div>

            <!-- Danger Zone Section -->
            <div class="form-group" style="margin-top: 32px; padding: 20px; border: 2px solid #dc3545; border-radius: 8px; background: #fff5f5;">
                <h3 style="color: #dc3545; margin: 0 0 12px 0;">⚠️ Danger Zone</h3>
                <p style="color: #721c24; font-weight: 500; margin-bottom: 16px; font-size: 13px;">
                    These operations are destructive and cannot be undone. Use with extreme caution!
                </p>

                <div style="margin-bottom: 16px;">
                    <button id="clearAllBookmarksTools" class="button danger" type="button" style="width: 100%;">Clear ALL Bookmarks</button>
                    <div class="help-text" style="color: #721c24; margin-top: 6px; font-weight: 500;">⚠️ WARNING: This will permanently delete ALL bookmarks in your browser! A backup is required before execution.</div>
                </div>

                <div id="clearConfirmationTools" class="confirmation-section" style="display: none; margin-top: 16px; padding: 16px; background: #fff; border: 1px solid #dc3545; border-radius: 6px;">
                    <div id="clearSyncWarningTools" class="status info" style="display:none; margin-top:0; margin-bottom: 12px;">
                        ⚠️ Raindrop Sync is currently enabled. After clearing, bookmarks may be restored from Raindrop automatically. Consider disabling "Enable Raindrop Sync" before proceeding.
                    </div>
                    <div style="margin-bottom: 16px;">
                        <div style="font-weight: 600; color: #721c24; margin-bottom: 8px;">📥 Step 1: Download Backup</div>
                        <button id="downloadBackupTools" class="button secondary" type="button" style="width: 100%;">Download Bookmarks Backup (JSON + HTML)</button>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <div style="font-weight: 600; color: #721c24; margin-bottom: 8px;">⚠️ Step 2: Confirm Deletion</div>
                        <div style="margin-bottom: 8px; color: #721c24; font-size: 13px;">Type <strong>"CLEAR ALL"</strong> to confirm:</div>
                        <input type="text" id="clearConfirmTextTools" placeholder="Type CLEAR ALL here" style="width: 100%; padding: 10px; margin-bottom: 8px; box-sizing: border-box; border: 2px solid #ddd; border-radius: 4px; font-size: 14px;" />
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button id="executeClearTools" class="button danger" disabled style="flex: 1;">Execute Clear All</button>
                        <button id="cancelClearTools" class="button secondary" style="flex: 1;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-general" data-tab="general">
            <h2>General Settings</h2>

            <div class="form-group">
                <h3>Interface Preferences</h3>
                <div style="margin: 16px 0;">
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="radio" name="notificationStyle" id="modernNotification" value="modern" checked>
                        <span><strong>Modern Notification Bar</strong> - Professional gradient design with glassmorphism effects</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="radio" name="notificationStyle" id="minimalNotification" value="minimal">
                        <span><strong>Minimal Notification Bar</strong> - Simple yellow warning design</span>
                    </label>
                </div>
                <div style="margin: 12px 0;">
                    <button id="applyNotificationStyle" class="button secondary" type="button">Apply Style</button>
                    <button id="previewNotificationStyle" class="button secondary" type="button">Preview</button>
                </div>
            </div>

            <div class="form-group">
                <h3>Color Theme</h3>
                <div style="margin: 12px 0; display: grid; gap: 8px; max-width: 380px;">
                    <label for="themeSelect">Choose theme</label>
                    <select id="themeSelect">
                        <option value="slate">Slate (Default)</option>
                        <option value="charcoal">Charcoal</option>
                        <option value="ocean">Ocean</option>
                    </select>
                    <div id="themePreview" class="help-text" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap; margin-top:6px;"></div>
                </div>
                <div style="margin: 12px 0; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                    <button id="applyTheme" class="button secondary" type="button">Apply Theme</button>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="darkModeToggle" />
                        <span>Dark Mode</span>
                    </label>

                </div>
            </div>

            <div class="form-group">
                <h3>🌙 Quiet Hours</h3>
                <p class="help-text">Prevent automatic syncing during specified hours to save battery or avoid interruptions.</p>
                <label style="display: flex; align-items: center; gap: 8px; margin: 12px 0;">
                    <input type="checkbox" id="quietHoursEnabled" />
                    <span>Enable Quiet Hours</span>
                </label>
                <div id="quietHoursSettings" style="display: none; margin-top: 12px; padding: 16px; background: #f8f9fa; border-radius: 6px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 12px;">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-weight: 500;">Start Time</label>
                            <input type="time" id="quietHoursStart" value="23:00" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-weight: 500;">End Time</label>
                            <input type="time" id="quietHoursEnd" value="07:00" style="width: 100%;">
                        </div>
                    </div>
                    <p class="help-text" style="margin: 0;">Sync will pause during these hours. Manual sync is still available.</p>
                </div>
            </div>

            <div class="form-group">
                <h3>⚡ Conditional Sync</h3>
                <p class="help-text">Automatically pause sync based on system conditions.</p>
                <label style="display: flex; align-items: center; gap: 8px; margin: 8px 0;">
                    <input type="checkbox" id="pauseOnLowBattery" />
                    <span>Pause on low battery (&lt;20%)</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; margin: 8px 0;">
                    <input type="checkbox" id="pauseOnMetered" />
                    <span>Pause on metered network (mobile data)</span>
                </label>
            </div>

            <div class="form-group">
                <h3>⚙️ Settings Management</h3>
                <p class="help-text">Export your settings for backup or import settings from another device.</p>
                <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
                    <button id="exportSettings" class="button secondary" type="button">📤 Export Settings</button>
                    <button id="importSettings" class="button secondary" type="button">📥 Import Settings</button>
                    <input type="file" id="importSettingsFile" accept=".json" style="display: none;" />
                </div>
            </div>

            <div class="form-group">
                <h3>Reset Settings</h3>
                <p class="help-text">Restore all settings to their recommended default values. This will not affect your bookmarks or Raindrop connection.</p>
                <button id="resetToDefaults" class="button secondary" type="button" style="margin-top: 12px;">Reset to Defaults</button>
            </div>
        </div>

        <div class="section tab-panel" id="tab-help" data-tab="help">
            <h2>❓ Help & Support</h2>
            <p class="help-text">Setup guides, tips, and support resources for using Open Bookmark Sync.</p>

            <!-- Quick Setup Guide -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <h3>🚀 Quick Setup Guide</h3>
                <ol style="margin: 16px 0; padding-left: 20px; line-height: 1.8;">
                    <li><strong>Connect:</strong> Go to Connect tab and choose "Managed OAuth" (recommended) or "Manual Configuration"</li>
                    <li><strong>Authenticate:</strong> Click "Authenticate with Raindrop" - no additional setup needed for Managed OAuth</li>
                    <li><strong>Configure Sync:</strong> In Sync Settings, choose your sync mode and interval</li>
                    <li><strong>Select Target:</strong> Choose which browser bookmarks folder to sync to</li>
                    <li><strong>Choose Collections:</strong> Select which Raindrop collections to sync</li>
                    <li><strong>Enable:</strong> Check "Enable Raindrop Sync" to start automatic synchronization</li>
                </ol>
            </div>

            <!-- Tips & Best Practices -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <h3>💡 Tips & Best Practices</h3>
                <ul style="margin: 16px 0; padding-left: 20px; line-height: 1.6;">
                    <li><strong>Authentication:</strong> Use "Managed OAuth" for easier setup - no need to create Raindrop app</li>
                    <li><strong>Safety First:</strong> Start with "One-way: Raindrop → Browser" sync mode (default)</li>
                    <li><strong>Collections:</strong> Use "Top-level only" collections setting initially</li>
                    <li><strong>Testing:</strong> Test with a longer sync interval (15-30 minutes) at first</li>
                    <li><strong>Backup:</strong> Export your bookmarks before making major changes</li>
                    <li><strong>Verification:</strong> Use the "Test Connection" button to verify your setup</li>
                </ul>
            </div>

            <!-- Sync Modes Explained -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <h3>⚙️ Sync Modes Explained</h3>
                <div style="margin: 16px 0;">
                    <div style="margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <strong>One-way: Raindrop → Browser (Default)</strong><br>
                        <span style="font-size: 12px; color: #6c757d;">Safest option. Downloads Raindrop bookmarks to browser only. Perfect for first-time users.</span>
                    </div>
                    <div style="margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <strong>Two-way: Additions only</strong><br>
                        <span style="font-size: 12px; color: #6c757d;">Safe bi-directional sync. Only adds new bookmarks, never deletes anything.</span>
                    </div>
                    <div style="margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <strong>Two-way: Mirror</strong><br>
                        <span style="font-size: 12px; color: #6c757d;">Bi-directional sync with additions and updates. Never deletes from Raindrop for safety.</span>
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <strong>One-way: Browser → Raindrop</strong><br>
                        <span style="font-size: 12px; color: #6c757d;">Uploads browser bookmarks to Raindrop only. Good for backing up browser bookmarks.</span>
                    </div>
                </div>
            </div>

            <!-- Support Resources -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 20px;">
                <h3 style="margin: 0 0 16px 0;">Support Resources</h3>

                <!-- Quick Actions -->
                <button id="copyDiagnostics" class="button neutral" style="width: 100%; margin-bottom: 16px; justify-content: center;">
                    📋 Copy Diagnostics for Issue Report
                </button>

                <!-- Links Grid (2 columns) -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                    <a id="supportPanelSite" class="header-link" href="#" target="_blank" rel="noopener noreferrer" style="padding: 10px 12px;">
                        <img src="icons/home.svg" alt="" class="icon" style="width: 16px; height: 16px;">
                        <span>Website</span>
                    </a>
                    <a class="header-link" href="https://github.com/spacechild-dev/open-bookmark-sync" target="_blank" rel="noopener noreferrer" style="padding: 10px 12px;">
                        <img src="icons/github.svg" alt="" class="icon" style="width: 16px; height: 16px;">
                        <span>GitHub</span>
                    </a>
                    <a class="header-link" href="https://github.com/spacechild-dev/open-bookmark-sync/blob/main/PRIVACY.md" target="_blank" rel="noopener noreferrer" style="padding: 10px 12px;">
                        <img src="icons/lock.svg" alt="" class="icon" style="width: 16px; height: 16px;">
                        <span>Privacy</span>
                    </a>
                    <a class="header-link" href="https://github.com/spacechild-dev/open-bookmark-sync/blob/main/ROADMAP.md" target="_blank" rel="noopener noreferrer" style="padding: 10px 12px;">
                        <img src="icons/layers.svg" alt="" class="icon" style="width: 16px; height: 16px;">
                        <span>Roadmap</span>
                    </a>
                </div>

                <!-- Report Issue (Full width) -->
                <a href="mailto:dagkan@spacechild.dev?subject=Raindrop%20Browser%20Sync%20-%20Issue%20Report&body=Hi%2C%0A%0AI%20found%20an%20issue%20with%20the%20Raindrop%20Browser%20Sync%20extension%3A%0A%0A%5BPlease%20describe%20the%20issue%20here%5D%0A%0AThanks%21" class="header-link" style="padding: 10px 12px; margin-bottom: 20px; display: flex;">
                    <img src="icons/mail.svg" alt="" class="icon" style="width: 16px; height: 16px;">
                    <span>📧 Report an Issue</span>
                </a>

                <!-- Support Section -->
                <div style="padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <h4 style="margin: 0 0 12px 0;">💝 Support the Project</h4>
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 8px;">
                        <!-- GitHub Sponsor iframe removed for Chrome Web Store compliance -->
                        <a href="https://github.com/sponsors/spacechild-dev" target="_blank" rel="noopener noreferrer" style="background: #24292e; color: #fff; padding: 8px 14px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 13px; display: inline-flex; align-items: center; gap: 8px; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <img src="icons/github.svg" alt="" style="width: 16px; height: 16px;">
                            <span>Sponsor on GitHub</span>
                        </a>
                        <a href="https://buymeacoffee.com/daiquiri" target="_blank" rel="noopener noreferrer" style="background: #FFDD00; color: #000; padding: 8px 14px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 13px; display: inline-flex; align-items: center; gap: 8px; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <img src="icons/coffee.svg" alt="" style="width: 16px; height: 16px;">
                            <span>Buy me a coffee</span>
                        </a>
                    </div>
                    <p class="help-text" style="margin: 0; font-size: 12px;">Your support helps keep this extension free and improving!</p>
                </div>
            </div>

            <!-- Sync History Timeline -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-top: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 style="margin: 0;">📅 Sync History Timeline</h3>
                    <button id="exportSyncHistory" class="button" style="height: 28px; padding: 0 10px; font-size: 11px;">📥 Export</button>
                </div>
                <div id="syncHistoryTimeline" style="max-height: 250px; overflow-y: auto; font-size: 12px; background: #f8f9fa; padding: 12px; border-radius: 4px;">
                    <div style="color: #999;">No sync history yet...</div>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="form-group" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-top: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 style="margin: 0;">Activity Log</h3>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="activityLogSearch" placeholder="Search..." style="width: 150px; height: 28px; padding: 0 8px; font-size: 11px; border: 1px solid #e9ecef; border-radius: 4px;">
                        <button id="clearActivityLog" class="button" style="height: 28px; padding: 0 10px; font-size: 11px;">Clear</button>
                    </div>
                </div>
                <div id="activityLogContainer" style="max-height: 200px; overflow-y: auto; font-size: 12px; font-family: monospace; background: #f8f9fa; padding: 8px; border-radius: 4px;">
                    <div style="color: #999;">No activity yet...</div>
                </div>
            </div>
        </div>

        </div> <!-- end tab-content -->
        
        <!-- Inline confirmation modal -->
        <div id="confirmationModal" class="inline-modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmationTitle" aria-describedby="confirmationMessage">
            <div class="inline-modal-backdrop" data-close="true"></div>
            <div class="inline-modal-dialog">
                <div class="inline-modal-header">
                    <h3 id="confirmationTitle">Confirm</h3>
                    <button id="confirmationClose" class="button-icon" type="button" aria-label="Close">&times;</button>
                </div>
                <div id="confirmationMessage" class="inline-modal-body"></div>
                <div class="inline-modal-actions">
                    <button id="confirmationCancel" class="button secondary" type="button">Cancel</button>
                    <button id="confirmationConfirm" class="button danger" type="button">Confirm</button>
                </div>
            </div>
        </div>

            </div> <!-- end main-content -->
        </div> <!-- end main -->
    </div>

    <!-- Welcome Screen Modal -->
    <div id="welcomeOverlay" class="welcome-overlay">
        <div class="welcome-modal">
            <div class="welcome-header">
                <h1>🎉 Welcome to Open Bookmark Sync!</h1>
                <p>Let's get you set up in just 3 easy steps</p>
            </div>
            <div class="welcome-content">
                <div class="welcome-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Connect to Raindrop.io</h3>
                        <p>Go to the <strong>Connect</strong> tab and click "Authenticate with Raindrop". Using Managed OAuth (recommended) requires no additional setup.</p>
                    </div>
                </div>
                <div class="welcome-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Choose What to Sync</h3>
                        <p>In the <strong>Sync Settings</strong> tab, select your sync mode and choose which collections to import. We recommend starting with "One-way: Raindrop → Browser" mode.</p>
                    </div>
                </div>
                <div class="welcome-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>You're All Set!</h3>
                        <p>Enable automatic sync and your bookmarks will stay in sync. Check the <strong>Guide</strong> tab for tips and best practices.</p>
                    </div>
                </div>
            </div>
            <div class="welcome-actions">
                <button id="welcomeSkip" class="welcome-btn secondary">Skip Tour</button>
                <button id="welcomeStart" class="welcome-btn primary">Let's Get Started!</button>
            </div>
        </div>
    </div>

    <script src="oauth.js"></script>
    <script src="ai-manager.js"></script>
    <script src="options.js"></script>
</body>
</html>
