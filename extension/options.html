<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Bookmark Sync - Settings</title>
    <link rel="stylesheet" href="modern-ui.css">
</head>
<body>
    <div id="app-container">
        <!-- Sidebar -->
        <aside id="sidebar">
            <div class="sidebar-header">
                <div class="logo-text">Open Bookmark Sync</div>
            </div>
            <nav class="sidebar-nav">
                <button class="side-link active" data-tab="api">
                    <img src="icons/connect.svg" alt="" class="icon">
                    Connect
                </button>
                <button class="side-link" data-tab="sync">
                    <img src="icons/settings.svg" alt="" class="icon">
                    Sync Settings
                </button>
                <button class="side-link" data-tab="ai">
                    <img src="icons/ai.svg" alt="" class="icon">
                    AI Organizer
                </button>
                <button class="side-link" data-tab="tools">
                    <img src="icons/tools.svg" alt="" class="icon">
                    Tools
                </button>
                <button class="side-link" data-tab="about">
                    <img src="icons/help.svg" alt="" class="icon">
                    Guide & Support
                </button>
            </nav>
            <div style="padding: 20px; border-top: 1px solid var(--mantine-color-gray-2);">
                <a href="https://github.com/spacechild-dev/open-bookmark-sync" target="_blank" class="side-link" style="text-decoration: none;">
                    <img src="icons/github.svg" alt="" class="icon">
                    GitHub
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content">
            <header class="content-header">
                <h1 class="page-title" id="active-tab-title">Connect</h1>
                <div id="header-actions">
                    <button id="fabSync" class="button primary">
                        <img src="icons/sync.svg" alt="" style="width: 16px; height: 16px; filter: brightness(0) invert(1);">
                        Sync Now
                    </button>
                </div>
            </header>
            
            <div class="scroll-area">
                <div id="statusMessage" class="status hidden" style="position: sticky; top: 0; z-index: 5; margin: 0 0 10px 0;"></div>

                <!-- Closeable Privacy Notice -->
                <div id="privacyNotice" class="card" style="border: 1px solid #e8f4f8; background: #f8fcff; margin-bottom: 16px;">
                    <div style="display: flex; align-items: flex-start; justify-content: space-between;">
                        <div>
                            <h3 style="margin: 0 0 8px 0; color: #0066cc;">ðŸ”’ Privacy & Security</h3>
                            <div class="help-text" style="margin: 0;">
                                <strong>No telemetry or tracking:</strong> This extension does not collect any usage data, analytics, or personal information.
                                All data stays on your device and your chosen sync service (Raindrop.io).
                                Authentication tokens are stored locally in Chrome's secure storage.
                            </div>
                        </div>
                        <button id="closePrivacyNotice" type="button" style="background: none; border: none; font-size: 18px; color: #666; cursor: pointer; padding: 4px; margin-left: 12px;" title="Close privacy notice">Ã—</button>
                    </div>
                </div>

                <div class="tab-panel active" id="tab-api" data-tab="api">
                    <div class="card">
                      <h2 class="card-title">Authentication</h2>
                      <div id="authMethodGroup" class="form-group">
                          <label for="authMethod">Authentication Method</label>
                          <select id="authMethod">
                              <option value="managed" selected>Managed OAuth (Recommended)</option>
                              <option value="manual">Manual Configuration</option>
                          </select>
                          <div class="help-text">Choose how to authenticate with Raindrop.io. Managed OAuth is safer and easier.</div>
                      </div>
                                  <div id="authStatus" class="auth-status">
                                      <div id="statusIndicator" class="status-indicator disconnected"></div>
                                      <span id="authStatusText">Not authenticated</span>
                                      <div id="userInfo"></div>
                                      <div id="statusDetails" class="status-details hidden"></div>
                                      <div id="authProgress" class="progress-bar hidden">
                                          <div id="authProgressFill" class="progress-bar-fill"></div>
                                      </div>
                                  </div>                      <div id="authButtons" style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                          <button id="authenticateBtn" class="button primary">Authenticate with Raindrop</button>
                          <button id="testConnection" class="button secondary">Test Connection</button>
                          <button id="logout" class="button danger hidden">Logout</button>
                      </div>
                    </div>
                    
                    <div id="manualConfigSection" class="card hidden">
                        <h2 class="card-title">Manual Configuration</h2>
                        <div id="manualConfigDetails">
                            <div id="clientIdGroup" class="form-group">
                                <label for="clientId">Client ID</label>
                                <div class="input-row">
                                    <input type="password" id="clientId" placeholder="Enter your Raindrop Client ID">
                                    <button id="toggleClientId" type="button" class="toggle-eye" aria-label="Show/Hide">Show</button>
                                </div>
                                <div class="help-text">Stored locally via Chrome storage. Hidden by default for privacy.</div>
                            </div>
                            <div id="clientSecretGroup" class="form-group">
                                <label for="clientSecret">Client Secret</label>
                                <div class="input-row">
                                    <input type="password" id="clientSecret" placeholder="Enter your Raindrop Client Secret">
                                    <button id="toggleClientSecret" type="button" class="toggle-eye" aria-label="Show/Hide">Show</button>
                                </div>
                                <div class="help-text">Do not share your client secret.</div>
                            </div>
                            <div id="redirectUriGroup" class="form-group">
                                <label for="redirectUri">Redirect URI</label>
                                <div class="input-row">
                                    <input type="url" id="redirectUri" class="pre-filled" placeholder="Extension identity redirect (auto)">
                                    <button id="redirectReset" type="button" class="toggle-eye" aria-label="Reset to default">Reset</button>
                                </div>
                            </div>
                            <div id="saveConfigSection" style="margin-top: 16px;">
                                <button id="saveConfig" class="button">Save Configuration</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-panel" id="tab-sync" data-tab="sync">
                    <!-- Sync Settings Content -->
                </div>
                <div class="tab-panel" id="tab-ai" data-tab="ai">
                    <!-- AI Organizer Content -->
                </div>
                <div class="tab-panel" id="tab-tools" data-tab="tools">
                    <div class="card">
                        <h2 class="card-title">Backup & Restore</h2>
                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 14px; margin-bottom: 12px;">Manual Backup</h3>
                            <div style="display: flex; gap: 8px;">
                                <button id="createBackup" class="button primary">Create Backup Now</button>
                                <button id="downloadBackupFile" class="button secondary">Download JSON</button>
                            </div>
                            <div class="help-text">Create a full backup of your current bookmarks.</div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 14px; margin-bottom: 12px;">Restore</h3>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button id="restoreFromFile" class="button secondary">Restore from File</button>
                                <input type="file" id="restoreFile" accept=".json" style="display: none;">
                                <button id="restoreLastBackup" class="button secondary">Restore Last Auto-Backup</button>
                            </div>
                            <div class="help-text">Restore bookmarks from a previous backup file or the last automatic backup.</div>
                        </div>

                        <div>
                            <h3 style="font-size: 14px; margin-bottom: 12px;">Auto-Backups</h3>
                            <div id="autoBackupsList" style="border: 1px solid var(--mantine-color-gray-3); border-radius: var(--mantine-radius-sm); max-height: 200px; overflow-y: auto; padding: 8px; background-color: var(--mantine-color-gray-0);">
                                <div class="help-text" style="padding: 8px;">No automatic backups found.</div>
                            </div>
                            <div style="margin-top: 8px; display: flex; justify-content: flex-end; gap: 8px;">
                                <button id="refreshAutoBackups" class="button secondary small">Refresh</button>
                                <button id="clearOldAutoBackups" class="button secondary small">Clear Old</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Cleanup Tools</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div>
                                <button id="scanDuplicates" class="button primary" style="width: 100%;">Scan for Duplicates</button>
                                <div class="help-text">Find and remove duplicate bookmarks.</div>
                            </div>
                            <div>
                                <button id="cleanEmptyFolders" class="button secondary" style="width: 100%;">Clean Empty Folders</button>
                                <div class="help-text">Remove folders that contain no bookmarks.</div>
                            </div>
                        </div>
                        <div id="duplicateStatus" class="status hidden">
                            <span id="duplicateStatusText"></span>
                        </div>
                    </div>
                </div>

                <div class="tab-panel" id="tab-about" data-tab="about">
                    <div class="card">
                        <h2 class="card-title">Sync History</h2>
                        <div id="syncHistoryTimeline" style="border: 1px solid var(--mantine-color-gray-3); border-radius: var(--mantine-radius-sm); height: 200px; overflow-y: auto; padding: 12px; background-color: var(--mantine-color-gray-0); font-family: monospace; font-size: 12px;">
                            <div style="color: var(--mantine-color-gray-6);">No sync history available.</div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Activity Log</h2>
                        <div id="activityLogContainer" style="border: 1px solid var(--mantine-color-gray-3); border-radius: var(--mantine-radius-sm); height: 200px; overflow-y: auto; padding: 12px; background-color: var(--mantine-color-gray-0); font-family: monospace; font-size: 12px;">
                            <div style="color: var(--mantine-color-gray-6);">No activity recorded.</div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">About & Support</h2>
                        <p>Open Bookmark Sync v1.3.2</p>
                        <div style="display: flex; gap: 12px; margin-top: 16px;">
                            <a href="https://spacechild.dev" target="_blank" class="button secondary">Website</a>
                            <a href="https://github.com/spacechild-dev/open-bookmark-sync" target="_blank" class="button secondary">GitHub</a>
                            <a href="https://github.com/spacechild-dev/open-bookmark-sync/issues" target="_blank" class="button secondary">Report Issue</a>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeOverlay" class="welcome-overlay hidden">
        <div class="welcome-modal">
            <div class="welcome-header">
                <h1>ðŸ‘‹ Welcome to Open Bookmark Sync!</h1>
                <p>Let's get you set up in just 3 easy steps.</p>
            </div>
            <div class="welcome-content">
                <div class="welcome-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Connect to Raindrop.io</h3>
                        <p>Click "Authenticate with Raindrop" to get started.</p>
                    </div>
                </div>
                <div class="welcome-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Configure Sync</h3>
                        <p>Go to the <strong>Sync Settings</strong> tab to choose your collections and sync mode.</p>
                    </div>
                </div>
                <div class="welcome-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>All Set!</h3>
                        <p>Enable automatic sync and your bookmarks will always be up-to-date.</p>
                    </div>
                </div>
            </div>
            <div class="welcome-actions">
                <button id="welcomeSkip" class="button secondary">Skip Tour</button>
                <button id="welcomeStart" class="button primary">Let's Get Started</button>
            </div>
        </div>
    </div>
    
    <script src="oauth.js"></script>
    <script src="ai-manager.js"></script>
    <script src="options.js"></script>
</body>
</html>